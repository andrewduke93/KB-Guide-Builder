<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi-level Nested Decision Tree Builder</title>
    <style>
        /* Styles remain mostly unchanged, ensure .nested-question has proper styling */
        .nested-question {
            margin-left: 20px;
            display: none; /* Initially hide nested questions */
        }
        /* Other styles are as previously defined */
    </style>
</head>
<body>

<div id="builder" class="question-container"></div>
<button onclick="addQuestion('builder', '', true, 0)">Add Main Question</button>
<textarea id="output" placeholder="Generated HTML code will appear here..."></textarea>
<button onclick="generateCode()">Generate HTML Code</button>
<button onclick="togglePreview()">Toggle Preview</button>
<div id="previewArea" style="display: none;"></div>

<script>
let questionCounter = 1;

function addQuestion(parentId, precedingQuestionId, isMainQuestion = false, level) {
    const questionId = `q${questionCounter++}`;
    const container = document.createElement('div');
    container.className = isMainQuestion ? 'question-block' : 'nested-question';
    container.innerHTML = `
        <textarea placeholder="${isMainQuestion ? 'Enter main question' : 'Enter nested question'}"></textarea>
        <div class="answers"></div>
        ${level < 10 ? `<button onclick="addAnswer('${questionId}', ${level + 1})">Add Answer</button>` : ''}
    `;
    
    if (!isMainQuestion) {
        const nestedContainer = document.createElement('div');
        nestedContainer.className = 'nested-questions';
        nestedContainer.appendChild(container);
        document.getElementById(precedingQuestionId).querySelector('.answers').appendChild(nestedContainer);
    } else {
        document.getElementById(parentId).appendChild(container);
    }
}

function addAnswer(questionId, level) {
    const answerContainer = document.createElement('div');
    answerContainer.className = 'answer-input';
    answerContainer.innerHTML = `
        <textarea placeholder="Enter answer"></textarea>
        ${level < 10 ? `<button onclick="addQuestion('builder', '${questionId}', false, ${level})">Add Nested Question</button>` : ''}
    `;
    document.getElementById(questionId).querySelector('.answers').appendChild(answerContainer);
}

function generateCode() {
    const output = document.getElementById('output');
    output.value = "<script>function toggleNestedQuestion(id) { document.querySelectorAll('.nested-question').forEach(q => { q.style.display = 'none'; }); document.getElementById(id) ? document.getElementById(id).style.display = 'block' : null; }</script>";
    traverseQuestions(document.getElementById('builder'), output, 0);
}

function traverseQuestions(element, output, level) {
    element.childNodes.forEach((child) => {
        if (child.className && child.className.includes('question-block')) {
            const questionText = child.querySelector('textarea').value;
            const questionId = `q${level}-${questionCounter++}`;
            output.value += `<div class="${level === 0 ? '' : 'nested-question'}" id="${questionId}">\n<p>${questionText}</p>\n`;
            const answers = child.querySelectorAll('.answer-input textarea');
            answers.forEach((answer, index) => {
                const answerText = answer.value;
                const nestedQuestionId = `nested-${questionId}-${index}`;
                output.value += `<input type="radio" name="${questionId}" onclick="toggleNestedQuestion('${nestedQuestionId}')">${answerText}<br>\n`;
                const nextLevel = child.querySelector('.nested-questions');
                if (nextLevel) {
                    traverseQuestions(nextLevel, output, level + 1);
                }
            });
            output.value += `</div>\n`;
        }
    });
}

function togglePreview() {
    const previewArea = document.getElementById('previewArea');
    const htmlCode = document.getElementById('output').value;
    previewArea.innerHTML = htmlCode;
    previewArea.querySelector('script') && eval(previewArea.querySelector('script').textContent);
    previewArea.style.display = previewArea.style.display === 'none' ? 'block' : 'none';
}
</script>

</body>
</html>
