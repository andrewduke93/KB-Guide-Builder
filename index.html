<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Complete Decision Tree Builder</title>
    <style>
        .question-container {
            display: flex;
            flex-direction: column;
        }
        .question-block, .nested-question {
            border: 1px solid #aaa;
            padding: 10px;
            margin: 5px 0;
            background-color: #f9f9f9;
        }
        .nested-questions {
            display: flex;
            flex-wrap: nowrap;
            margin-top: 10px;
            overflow-x: auto;
        }
        .answer-input {
            margin: 5px 0;
        }
    </style>
</head>
<body>

<div id="builder" class="question-container"></div>
<button onclick="addQuestion('builder', '', true)">Add Main Question</button>
<textarea id="output" style="width: 100%; height: 200px;" readonly placeholder="Generated HTML code will appear here..."></textarea>
<button onclick="generateCode()">Generate HTML Code</button>

<script>
let questionCounter = 1;

function addQuestion(parentId, precedingQuestionId, isMainQuestion = false) {
    let questionId = `q${questionCounter++}`;
    let container = document.createElement('div');
    container.className = isMainQuestion ? 'question-block' : 'nested-question';
    container.id = questionId;
    container.innerHTML = `
        <label>${isMainQuestion ? 'Main Question:' : 'Nested Question:'} <textarea oninput="updateStructure()"></textarea></label>
        <div class="answers"></div>
        <button onclick="addAnswer('${questionId}')">Add Answer</button>
    `;

    if (!isMainQuestion) {
        let nestedContainer = document.createElement('div');
        nestedContainer.className = 'nested-questions';
        nestedContainer.appendChild(container);
        document.getElementById(precedingQuestionId).querySelector('.answers').lastElementChild.appendChild(nestedContainer);
    } else {
        document.getElementById(parentId).appendChild(container);
    }

    updateStructure();
}

function addAnswer(questionId) {
    let answerContainer = document.createElement('div');
    answerContainer.className = 'answer-input';
    answerContainer.innerHTML = `
        Answer: <textarea oninput="updateStructure()"></textarea>
        <button onclick="addQuestion('builder', '${questionId}', false)">Add Nested Question</button>
    `;
    document.getElementById(questionId).querySelector('.answers').appendChild(answerContainer);
    updateStructure();
}

function generateCode() {
    document.getElementById('output').value = buildHTML(document.getElementById('builder'), 0);
}

function buildHTML(element, level) {
    let html = '';
    element.childNodes.forEach((child) => {
        if (child.className === 'question-block' || child.className === 'nested-question') {
            let questionText = child.querySelector('label textarea').value.trim();
            html += `<div style="margin-left: ${level * 20}px;">\n<p>${questionText}</p>\n`;
            let answers = child.querySelectorAll('.answer-input textarea');
            answers.forEach((answer) => {
                let answerText = answer.value.trim();
                if (answerText) {
                    html += `<p>- ${answerText}</p>\n`;
                }
            });
            let nestedQuestions = child.querySelectorAll('.nested-questions');
            nestedQuestions.forEach((nested) => {
                html += buildHTML(nested, level + 1);
            });
            html += `</div>\n`;
        }
    });
    return html;
}

function updateStructure() {
    // Placeholder for any real-time updates or validations
}

</script>

</body>
</html>
