<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enhanced Decision Tree Builder</title>
    <style>
        textarea {
            width: 300px; /* Wider text area */
            height: 60px; /* Taller text area */
            margin-bottom: 5px; /* Spacing between text areas */
            resize: vertical; /* Allows vertical resizing */
        }
        .container {
            margin-bottom: 10px;
            border: 1px solid #ccc; /* Visual separation of questions/answers */
            padding: 10px;
        }
        #codeOutput {
            width: 100%;
            height: 150px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="builder"></div>
<button onclick="addQuestion('builder', '')">Add Main Question</button>
<button onclick="resetBuilder()">Reset</button>
<button onclick="undoAction()">Undo</button>
<button onclick="preview()">Preview</button>
<textarea id="codeOutput" readonly placeholder="Preview or generated outline will appear here..."></textarea>

<script>
let idCounter = 0;
let historyStack = [];

function addQuestion(parentId, prefix, saveHistory = true) {
    const container = document.createElement('div');
    container.className = 'container';
    const questionId = `q${prefix}${++idCounter}`;
    container.innerHTML = `
        <textarea id="${questionId}" placeholder="Enter your question here..."></textarea>
        <div id="answers${questionId}"></div>
        <button onclick="addAnswer('${questionId}')">Add Answer</button>
    `;
    document.getElementById(parentId).appendChild(container);
    if (saveHistory) saveState();
}

function addAnswer(questionId, saveHistory = true) {
    const answerContainer = document.getElementById(`answers${questionId}`);
    const answerId = `${questionId}a${++idCounter}`;
    const answerDiv = document.createElement('div');
    answerDiv.className = 'container';
    answerDiv.innerHTML = `
        <textarea id="${answerId}" placeholder="Enter answer..."></textarea>
        <button onclick="addQuestion('answers${questionId}', '${answerId}')">Add Nested Question</button>
    `;
    answerContainer.appendChild(answerDiv);
    if (saveHistory) saveState();
}

function resetBuilder() {
    document.getElementById('builder').innerHTML = '';
    historyStack = [];
}

function undoAction() {
    if (historyStack.length > 1) {
        historyStack.pop(); // Remove the current state
        const lastState = historyStack.pop(); // Pop the last state to revert
        document.getElementById('builder').innerHTML = lastState;
        saveState(); // Save the reverted state as the current state
    } else if (historyStack.length === 1) {
        resetBuilder(); // If only one state, reset completely
    }
}

function preview() {
    generateCode();
}

function generateCode() {
    const output = document.getElementById('codeOutput');
    output.value = ''; // Clear previous output
    generateCodeFromElement(document.getElementById('builder'), '', 0);
}

function generateCodeFromElement(element, prefix, level) {
    if (!element) return;
    Array.from(element.children).forEach(child => {
        if (child.tagName === 'TEXTAREA') {
            const indentation = ' '.repeat(level * 2); // Indent based on nesting level
            const output = document.getElementById('codeOutput');
            output.value += `${indentation}${prefix} ${child.value}\n`;
        }
        generateCodeFromElement(child, prefix, level + (child.className === 'container' ? 1 : 0));
    });
}

function saveState() {
    const builderHTML = document.getElementById('builder').innerHTML;
    historyStack.push(builderHTML);
}

// Initial call to save the initial state
saveState();
</script>

</body>
</html>
